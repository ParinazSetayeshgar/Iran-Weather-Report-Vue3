<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css" type="text/css">
    <link rel="shortcut icon" href="./assests/thermometer.ico" type="image/x-icon"> 
    <title>Tehran Current Weather</title>
</head>
<body>
    <header>
        <div class="info">
            <div class="tehran">Tehran</div>
            <div class="today"></div>
        </div>
        <div class="time"></div>
    </header>
    <main>
        <div class="icon">
                <img alt="weather icon">
        </div>
        <div class="report">
            <div class="temperature"></div>
            <div class="weather"></div>
        </div>
    </main>
    <footer>
        Developed By Parinaz Setayeshgar
    </footer>
    <script type="text/javascript">
    //storing elements
        var today = document.querySelector(".today");
        var time = document.querySelector(".time");

        var icon = document.querySelector("img");

        var weatherReport = document.querySelector(".weather");
        var temperatureReport = document.querySelector(".temperature");

        //Declaring function for defining background image
        function backgroundImg (currentHour, currentMinutes, sunsetHour, sunsetMinutes) {
        let mediaQuery = window.matchMedia('(min-width: 481px) and (max-width: 767px)');
        if (mediaQuery.matches) {
            if (currentHour == sunsetHour) {
                if ( currentMinutes > sunsetMinutes) {
                    document.body.className = "night-mobile";
                } else {
                    document.body.className = "day-mobile";
                }
            } else if (currentHour > sunsetHour) {
                document.body.className = "night-mobile";
            } else {
                document.body.className = "day-mobile";
            }
        } else {
            if (currentHour == sunsetHour) {
                if ( currentMinutes > sunsetMinutes) {
                    document.body.className = "night";
                } else {
                    document.body.className = "day";
                }
            } else if (currentHour > sunsetHour) {
                document.body.className = "night";
            } else {
                document.body.className = "day";
            }
        }
        }

        //calling API
        fetch('http://api.openweathermap.org/data/2.5/weather?q=Tehran&units=metric&appid=59047e5b5fb99d3b3a17ffa14fe1730d')

        .then(response => response.json()) //creating climate object

        .then(function(climate) {
            //defining date of today & current time
            let dateOfToday = new Date()
            let dateOfTodayArray = dateOfToday.toString().split(" ");
            for (let i=0 ; i<4 ; i++) {
                today.innerHTML += dateOfTodayArray[i] + " ";
            }
            let timeArray = dateOfTodayArray[4].toString().split(":");
            time.innerHTML = timeArray[0] + ":" + timeArray[1] ;

            //Defining sunset time
            let unixTime = new Date(climate.sys.sunset * 1000);
            let sunsetH = unixTime.getHours();
            let sunsetM = unixTime.getMinutes();

            //background image change
            backgroundImg (timeArray[0], timeArray[1], sunsetH, sunsetM);
            
            //showing weather description
            weatherReport.innerHTML = climate.weather[0].description;

            //showing temperature in Celsius
            temperatureReport.innerHTML = Math.floor(climate.main.temp) + "&#176;c";

            //showing icons
            switch(climate.weather[0].icon) {
            case "01d":
                icon.src = "./assests/sun.png";
                break;
            case "01n":
                icon.src = "./assests/moon.png";
                break;
            case "02d":
                icon.src = "./assests/sun & cloud.png";
                break;
            case "02n":
                icon.src = "./assests/moon & cloud.png";
                break;
            case "03d":
            case "03n":
            case "04d":
            case "04n":
                icon.src = "./assests/clouds.png";
                break;
            case "09d":
            case "09n":
            case "10d":
            case "10n":
                icon.src = "./assests/rain.png";
            case "11d":
            case "11n":
                icon.src = "./assests/lightning.png";
                break;
            case "13d":
            case "13n":
                icon.src = "./assests/snowy.png";
                break;
            case "50d":
            default:
                icon.src = "./assests/mist.png";
        }
            
        });
    </script>
</body>
</html>
